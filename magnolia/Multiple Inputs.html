<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Multiple Inputs | Learning arduino with the Magnolia</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="raspofabs">
        <meta name="description" content="This gitbook is a guide for beginners who have their hands on a Magnolia board from the L.A. Robotics club, originally developed as a Kickstarter campaign to produce an Arduino inspired robotics starter kit for a very meagre sum of $5 per board.">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        
        <link rel="prev" href="./Shift Registers.html" />
        

        <meta property="og:title" content="Multiple Inputs | Learning arduino with the Magnolia">
        <meta property="og:site_name" content="Learning arduino with the Magnolia">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/raspofabs">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="gitbook/style.css">
        


        
    <div class="book" data-github="raspofabs/magnoliabook" data-level="11" data-basepath="." data-revision="1399322083067">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/raspofabs/magnoliabook" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    
    <a href="https://github.com/raspofabs/magnoliabook/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/raspofabs/magnoliabook/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1><a href="./" >Learning arduino with the Magnolia</a></h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/raspofabs" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/raspofabs/magnoliabook/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/raspofabs/magnoliabook/edit/master/Multiple Inputs.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        
        <li data-level="0" data-path="index.html">
            <a href="./"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="Software requirements.html">
                
                <a href="./Software requirements.html">
                    <i class="fa fa-check"></i> <b>1.</b> Basic requirements
                </a>
                
                
            </li>
        
            <li  data-level="2" data-path="First steps.html">
                
                <a href="./First steps.html">
                    <i class="fa fa-check"></i> <b>2.</b> First steps
                </a>
                
                
            </li>
        
            <li  data-level="3" data-path="Multiple lights.html">
                
                <a href="./Multiple lights.html">
                    <i class="fa fa-check"></i> <b>3.</b> Multiple lights
                </a>
                
                
            </li>
        
            <li  data-level="4" data-path="Buttons.html">
                
                <a href="./Buttons.html">
                    <i class="fa fa-check"></i> <b>4.</b> Buttons
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1" data-path="Pulldowns and Pullups.html">
                            
                            <a href="./Pulldowns and Pullups.html">
                                <i class="fa fa-check"></i> <b>4.1.</b> Pulldowns and Pullups
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="5" data-path="Serial output.html">
                
                <a href="./Serial output.html">
                    <i class="fa fa-check"></i> <b>5.</b> Serial output
                </a>
                
                
            </li>
        
            <li  data-level="6" data-path="Serial input.html">
                
                <a href="./Serial input.html">
                    <i class="fa fa-check"></i> <b>6.</b> Serial input
                </a>
                
                
            </li>
        
            <li  data-level="7" data-path="Analogue Input.html">
                
                <a href="./Analogue Input.html">
                    <i class="fa fa-check"></i> <b>7.</b> Analogue Input
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="7.1" data-path="Voltage dividers.html">
                            
                            <a href="./Voltage dividers.html">
                                <i class="fa fa-check"></i> <b>7.1.</b> Voltage dividers
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="8" data-path="Filesystem.html">
                
                <a href="./Filesystem.html">
                    <i class="fa fa-check"></i> <b>8.</b> Filesystem
                </a>
                
                
            </li>
        
            <li  data-level="9" data-path="Servos.html">
                
                <a href="./Servos.html">
                    <i class="fa fa-check"></i> <b>9.</b> Servos
                </a>
                
                
            </li>
        
            <li  data-level="10" data-path="Shift Registers.html">
                
                <a href="./Shift Registers.html">
                    <i class="fa fa-check"></i> <b>10.</b> Shift Registers
                </a>
                
                
            </li>
        
            <li  data-level="11" data-path="Multiple Inputs.html">
                
                <a href="./Multiple Inputs.html">
                    <i class="fa fa-check"></i> <b>11.</b> Multiple Inputs
                </a>
                
                
            </li>
        
            <li  data-level="12" >
                
                <span><b>12.</b> Touch sensing</span>
                
                
            </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 23.076923076923077%;min-width: 15.384615384615385%;"></div>
    </div>
    <div class="chapters">
    
        <a href="./index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="./Software requirements.html" title="Basic requirements" class="chapter done new-chapter" data-progress="1" style="left: 7.6923076923076925%;"></a>
    
        <a href="./Shift Registers.html" title="Shift Registers" class="chapter done " data-progress="10" style="left: 15.384615384615385%;"></a>
    
        <a href="./Multiple Inputs.html" title="Multiple Inputs" class="chapter done " data-progress="11" style="left: 23.076923076923077%;"></a>
    
        <a href="./First steps.html" title="First steps" class="chapter  new-chapter" data-progress="2" style="left: 30.76923076923077%;"></a>
    
        <a href="./Multiple lights.html" title="Multiple lights" class="chapter  new-chapter" data-progress="3" style="left: 38.46153846153846%;"></a>
    
        <a href="./Buttons.html" title="Buttons" class="chapter  new-chapter" data-progress="4" style="left: 46.15384615384615%;"></a>
    
        <a href="./Pulldowns and Pullups.html" title="Pulldowns and Pullups" class="chapter  " data-progress="4.1" style="left: 53.84615384615385%;"></a>
    
        <a href="./Serial output.html" title="Serial output" class="chapter  new-chapter" data-progress="5" style="left: 61.53846153846154%;"></a>
    
        <a href="./Serial input.html" title="Serial input" class="chapter  new-chapter" data-progress="6" style="left: 69.23076923076923%;"></a>
    
        <a href="./Analogue Input.html" title="Analogue Input" class="chapter  new-chapter" data-progress="7" style="left: 76.92307692307692%;"></a>
    
        <a href="./Voltage dividers.html" title="Voltage dividers" class="chapter  " data-progress="7.1" style="left: 84.61538461538461%;"></a>
    
        <a href="./Filesystem.html" title="Filesystem" class="chapter  new-chapter" data-progress="8" style="left: 92.3076923076923%;"></a>
    
        <a href="./Servos.html" title="Servos" class="chapter  new-chapter" data-progress="9" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_5">
                    
                        <h1 id="multiple-inputs">Multiple Inputs</h1>
<p>Shift registers come as input types as well as output types. To get more inputs than six into your Magnolia, whilst reducing the number of pins used to do it, we use a shift-in register, or a parallel to serial convertor. We are going to use a CD4021B, a shift in register</p>
<pre><code>P8  1   U   16 Vcc
Q6  2       15 P7
Q8  3       14 P6
P4  4       13 P5
P3  5       12 Q7
P2  6       11 SER
P1  7       10 CLK
GND 8        9 LATCH
</code></pre><p>The basic function of the shift-in register is the same as the shift register, the master (Magnolia) triggers the serial clock to shift the registers inside the chip. In both these chips, one pin can push data into the chip. In the shift-in register, there are three output pins, but we&#39;re not going to use all three, think of them as being convenient optional additions.</p>
<p>In the shift-register, we had a latch pin that when triggered, took the internal registers Q&#39; and put them out to the external registers Q. In the shift-in register, we have internal registers Q, and when we trigger the latch pin &#39;LATCH&#39;, the external registers P overwrite them.</p>
<p>In this way, we can request the input pins are put into the internal buffer (Q), and then read each pin at our leisure (triggering the <strong>CLK</strong> to request the next value.)</p>
<h2 id="the-code">The code</h2>
<p>First, we set up which pins we&#39;re going to use.</p>
<pre><code>int Q8 = A0;
int CLK = A1;
int LATCH = A2;

void setup() {
    Serial.begin(9600);
    // SER is input, not output.
    pinMode(Q8, INPUT);
    // both clocks are still output.
    pinMode(CLK, OUTPUT);
    pinMode(LATCH, OUTPUT);
    Serial.println(&quot;Starting&quot;);
}
</code></pre><p>Like the shift-registers, the shift-in registers have a need for a low to high trigger. We can reuse the trigger function from the shift-registers code example.</p>
<pre><code>void trigger( int pin )
{
    digitalWrite(pin,HIGH);
    digitalWrite(pin,LOW);
}
</code></pre><p>Like the serial output, we have a two stage process, but with input we <em>get</em> the values then <em>read</em> them.</p>
<pre><code>int get_pins() {
    trigger(LATCH);
    int value = 0;
    for( int i = 0; i &lt; 8; ++i ) {
        value = value &lt;&lt; 1;
        value += get_one();
    }
    return value;
}
</code></pre><p><code>get_one</code> is meant to read a single value from the serial registers (the Q values in this chip)</p>
<pre><code>void get_one( int val ) {
    int value = digitalRead(Q8);
    trigger(CLK);
    return value;
}
</code></pre><p>Finally, we will use the value by printing it to the Serial Monitor.</p>
<pre><code>void loop() {
    int value = get_pins();
    Serial.println(value);
    delay(100);
}
</code></pre><h2 id="wiring">Wiring</h2>
<p>The wiring is a little less complicated for this chip. Every input needs t be pulled-down, but apart from that, there are less wires to worry about.</p>
<ul>
<li>Connect Magnolia <strong>GND</strong> to:</li>
<li><ul>
<li><strong>GND</strong> on the CD4021</li>
</ul>
</li>
<li><ul>
<li>via a pulldown resistor, <strong>P1</strong> through <strong>P8</strong></li>
</ul>
</li>
<li>Connect <strong>A0</strong> to <strong>q</strong></li>
<li>Connect <strong>A1</strong> to <strong>CLK</strong></li>
<li>Connect <strong>A2</strong> to <strong>LATCH</strong></li>
<li>Wire up the buttons between <strong>VCC</strong> and <strong>P1</strong> through <strong>P8</strong></li>
</ul>
<p><img src="cd4021_bb.png" alt="CD4021"></p>
<h2 id="more-inputs">More inputs</h2>
<p>Just as with shift registers, we can chain shift-in registers. As mentioned at the start of this lesson, both chips have serial input, and that means that you can tie <strong>Q8</strong> to <strong>SER</strong> on the next chip down. Make the <strong>SERCLK</strong> common, and the same with <strong>PAR</strong>, and you have all you need to run 16 inputs with the same number of IO pins from the Magnolia.</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="./Shift Registers.html" class="navigation navigation-prev"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="gitbook/app.js"></script>
        

    
    <script src="gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
